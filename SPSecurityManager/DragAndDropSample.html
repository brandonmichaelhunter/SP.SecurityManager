<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>jQuery UI Sortable - Connect lists</title>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.0/themes/smoothness/jquery-ui.css">
  <script src="http://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="http://code.jquery.com/ui/1.11.0/jquery-ui.js"></script>
  
  <style>
  .containers {
    border: 1px solid #eee;
    width: 300px;
    min-height: 20px;
    list-style-type: none;
    margin: 0;
    padding: 5px 0 0 0;
    float: left;
    margin-right: 10px;
  }
  .UserNameContainer{width:100%;}
  .UserNameNamePanel{float:left;}
  .UserNameIconPanel{float:right;}
  .UserNameFooterPanel{clear:both;}
  .selected{color:red;}
  .containers li {
    margin: 0 5px 5px 5px;
    padding: 5px;
    font-size: 1.2em;
    width: 300px;
  }
  </style>
  <script>
  function GetSecurityDetails()
  {
    var secObjs = [];
    var secObj = new Object();
    secObj.GroupName  = "Group1"
    secObj.GroupID = 1;
    secObj.UserName = "Brandon M. Hunter";
    secObj.UserEmail = "bhunter@gmail.com";
    secObj.UserID = 1;
    secObjs.push(secObj);

    var secObj = new Object();
    secObj.GroupName  = "Group1"
    secObj.GroupID = 1;
    secObj.UserName = "Brandon I. Hunter";
    secObj.UserEmail = "bhunterI@gmail.com";
    secObj.UserID = 2;
    secObjs.push(secObj);

    var secObj = new Object();
    secObj.GroupName  = "Group1"
    secObj.GroupID = 1;
    secObj.UserName = "Cameron M. Hunter";
    secObj.UserEmail = "chunter@gmail.com";
    secObj.UserID = 3;
    secObjs.push(secObj);

    var secObj = new Object();
    secObj.GroupName  = "Group2"
    secObj.GroupID = 2;
    secObj.UserName = "Annie L. Hunter";
    secObj.UserEmail = "ahunter@gmail.com";
    secObj.UserID = 4;
    secObjs.push(secObj);

    var secObj = new Object();
    secObj.GroupName  = "Group2"
    secObj.GroupID = 2;
    secObj.UserName = "Cora J. Hunter";
    secObj.UserEmail = "cjhunter@gmail.com";
    secObj.UserID = 5;
    secObjs.push(secObj);

    var secObj = new Object();
    secObj.GroupName  = "UsersGroup"
    secObj.GroupID = 3;
    secObj.UserName = "Kym Hunter";
    secObj.UserEmail = "Khunter@gmail.com";
    secObj.UserID = 6;
    secObjs.push(secObj);

    var secObj = new Object();
    secObj.GroupName  = "UsersGroup"
    secObj.GroupID = 3;
    secObj.UserName = "Andrea Hunter";
    secObj.UserEmail = "ahunter@gmail.com";
    secObj.UserID = 7;
    secObjs.push(secObj);

    var secObj = new Object();
    secObj.GroupName  = "UsersGroup"
    secObj.GroupID = 3;
    secObj.UserName = "Kym Hunter Jr";
    secObj.UserEmail = "KhunterII@gmail.com";
    secObj.UserID = 8;
    secObjs.push(secObj);

    return secObjs;
  }
  function LoadUI()
  {
    var securityObjs = GetSecurityDetails();
    var oldGroup = "";
    var newGroup = "";
    var htmlString = "";
    var Groups = [];
    htmlString += "<table><tr>";
    for(var a = 0; a < securityObjs.length; a++)
    {

            newGroup = securityObjs[a].GroupName;
            if(newGroup != oldGroup)
            {
               var group = new Object()
               group.GroupName = securityObjs[a].GroupName;
               group.GroupID = securityObjs[a].GroupID;
               Groups.push(group)
               oldGroup = newGroup;
            }

    }
    for(var b = 0; b < Groups.length; b++)
    {
        htmlString += "<td valign='top'><div><div  groupid='"+Groups[b].GroupID+"'>"+Groups[b].GroupName+"</div><div>";
        htmlString += "<ul id='"+Groups[b].GroupName+"' class='connectedSortable groups containers'>";
        for(var c = 0; c < securityObjs.length; c++){
            if(Groups[b].GroupID == securityObjs[c].GroupID){
                var UserName = securityObjs[c].UserName;
                var UserID = securityObjs[c].UserID;
                var UserEmail = securityObjs[c].UserEmail;

                htmlString += "<li userid='"+UserID+"' username='"+UserName+"' class='ui-state-default'><div class='UserNameContainer'><div class='UserNameNamePanel'>"+UserName+"</div><div class='UserNameIconPanel'><a href='#' Title='Delete User' userid='"+UserID+"' class='DeleteMe'>&nbsp;&nbsp;<img src='Images/Delete_Icon_15x15.png' alt='Delete User' /></a></div><div class='UserNameIconPanel'><a class='Info' userid='"+UserID+"' href='#' Title='User Info'>&nbsp;&nbsp;<img src='Images/Info_Icon_15x15.png' alt='User Info' /></a></div><div class='UserNameFooterPanel'></div></div></li>"; 
            }
        }
        htmlString += "</ul></div></div></td>";
    }
    htmlString += "<td valign='top'><div><div  groupid='Events'>Events</div><div>";
    htmlString += "<ul id='EventsList'></ul></div></div></td>";
    htmlString += "</tr></table>";
    $("body").append(htmlString);
  }
  /* Issue: I can drag two items to it's destination list, but the oriignal list on recieves the first last dragged item instead of the n of items I dragged when I started.*/
  $(function() {
    LoadUI();
    var cloneItem = "";
    var parentContainer = "";
    var currentContainer = "";
    var isFound = false;
    var currentID= "";
    $( ".groups" ).on('click', 'li', function (e) {
    if (e.ctrlKey || e.metaKey) {
        $(this).toggleClass("selected");
    } else {
        $(this).addClass("selected").siblings().removeClass('selected');
    }
}).sortable({
      connectWith: ".connectedSortable",
      delay: 150,
      revert: 0,
      revert: false,
      //helper: 'clone',
      activate: function(event, ui){$("#EventsList").append("<li>activate</li>");},
      beforeStop: function(event, ui){$("#EventsList").append("<li>beforeStop</li>");},
      change: function(event,ui){$("#EventsList").append("<li>change</li>");},
      create: function(event, ui){$("#EventsList").append("<li>create</li>");},
      deactivate: function(event, ui){$("#EventsList").append("<li>deactivate</li>");},
      out: function(event,ui){$("#EventsList").append("<li>out</li>");},
      over: function(event,ui){$("#EventsList").append("<li>over</li>");},
      sort: function(event, ui){$("#EventsList").append("<li>sort</li>");},
      update: function(event,ui){$("#EventsList").append("<li>update</li>");},
      helper: function (e, item) {
         $("#EventsList").append("<li>helper</li>");
         var helper = $('<li/>');
            /**/
            if (!item.hasClass('selected')) {
                item.addClass('selected').siblings().removeClass('selected');
            }
            /* Actions against the current parent. */
            var elements = item.parent().children('.selected').clone();
            item.data('multidrag', elements).siblings('.selected').remove();
            item.parent().append(elements.clone().removeClass('selected'));
            return helper.append(elements);
      },
      start: function (event, ui){$("#EventsList").append("<li>start</li>");},
      remove: function(event, ui){$("#EventsList").append("<li>remove</li>");},
      receive: function (event, ui) 
      {
         $("#EventsList").append("<li>receive</li>");
         currentID = "#"+$(ui.item).parent().attr("id");
         ui.item.data('multidrag').each(function () {
                $(this).removeClass('selected');
                var count = $(ui.item).parent().find('[userid="' + $(this).attr("userid") + '"]').length; 
                if ($(ui.item).parent().find('[userid="' + $(this).attr("userid") + '"]').length > 1) {
                    $(ui.item).remove();
                }
            });
            ui.item.after(ui.item.data('multidrag')).remove();
      },
      stop: function(event,ui){
        $("#EventsList").append("<li>stop</li>");
        /* Look in the original container and remove any duplicates */
        var currentElements = $(currentID).children("li").clone();
        currentElements.each(function()
        {
              var userid = $(this).attr("userid");
              var NumOfItemsFound = $(currentID).find('[userid="' + userid + '"]').length;
              if(NumOfItemsFound > 1)
              {
                 $(currentID).find('[userid="' + userid + '"]:first').remove();
              } 
        });

        /* Sort the list. */
        var Users = $(currentID);
        var UsersLI = Users.children('li');
        var listItems = UsersLI.sort(function(a,b){
            var an = a.getAttribute('username');
            var bn = b.getAttribute('username');

            if(an > bn){
               return 1;
            }

            if(an < bn){
               return -1;
            }
        });

        UsersLI.detach().appendTo(Users);
      } 
    });
    function sort_li(a, b){
    return ($(b).data('userid')) < ($(a).data('userid')) ? 1 : -1;    
    }
    $(".DeleteMe").click(function(){
          $(this).context.parentElement.remove();
    });
   //$("li").click(function() {
    //  $(this).toggleClass("selected");
   // });
  });
  
  </script>
</head>
<body>

</body>
</html>